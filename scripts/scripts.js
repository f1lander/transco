"use strict";var app=angular.module("chekku",["ui.router","ngAnimate","angular-loading-bar","toaster","ngMaterial","smart-table"]).config(["$httpProvider",function(e){e.interceptors.push(["$q","$rootScope","$injector","cfpLoadingBar","toaster",function(e,t,r,a,o){return{request:function(e){return e.headers=e.headers||{},a.start(),e},response:function(t){return a.complete(),t||e.when(t)},responseError:function(t){var r=e.defer();return 400===t.status?(o.pop("error","Error de Ingreso","Su usuario o contraseña son invalidos"),r.reject(t)):0===t.status?(o.pop("warning","Error de conexion","Por favor revise su conexion a internet"),r.reject(t)):422===t.status?(o.pop("warning","Error al eliminar","No se puede eliminar esta entidad ya que hay registros relacionados"),r.reject(t)):404===t.status&&(o.pop("warning","No Encontrado","Pagina o archivo no encontrado"),r.reject(t),a.complete()),a.complete(),r.promise}}}])}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/dashboard","/dashboard/overview"),t.otherwise("/login"),e.state("base",{"abstract":!0,url:"",templateUrl:"views/base.html"}).state("login",{url:"/login",parent:"base",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("dashboard",{url:"/dashboard",parent:"base",templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).state("overview",{url:"/overview",parent:"dashboard",templateUrl:"views/dashboard/overview.html"}).state("reports",{url:"/reports",parent:"dashboard",templateUrl:"views/dashboard/reports.html"})}]);app.run(["$rootScope","ParseService","$state",function(e,t,r){t.init(),e.$on("$stateChangeStart",function(t,a,o,n){return e.currentUser&&"login"==a.name?(r.go("dashboard"),void t.preventDefault()):e.currentUser||"login"==a.name?void 0:(r.go("login"),void t.preventDefault())})}]),app.constant("_",window._).run(["$rootScope",function(e){e._=window._}]),app.controller("LoginCtrl",["$scope","$rootScope","$state","ParseService","cfpLoadingBar",function(e,t,r,a,o){e.submit=function(){a.logIn(e.credentials)}}]),app.controller("DialogController",["$scope","$mdDialog",function(e,t){}]),app.controller("DashboardCtrl",["$scope","$state","ParseService","$mdDialog","$mdMedia","toaster","cfpLoadingBar","_","$rootScope",function(e,t,r,a,o,n,l,s,i){var c=Parse.Object.extend("Travels");e.filtro="",e.dates={},e.saveVisible=!1;var d=new Date;e.dblClick=function(){console.log("doubleclick")},e.dates.fromDate=new Date(d.getFullYear()-1,d.getMonth(),d.getDate(),0,0,0),e.dates.toDate=new Date(d.getFullYear(),d.getMonth(),d.getDate(),23,59,59),e.travel={},e.$state=t,e.checkIns=[],e.rowCollection=[],e.collectionToSave=[],e.saveChanges=function(){l.start();for(var t=new Parse.Query(c),r=0;r<e.collectionToSave.length;r++)t.get(e.collectionToSave[r].id,{success:function(t){var r=s.find(e.collectionToSave,function(e){return e.id==t.id});t.set("status",r.status),t.save(),l.complete(),n.pop("success","Registro guardado correctamente")},error:function(e,t){n.pop("error","Ocurrió un error al guardar el registro"),l.complete()}})},e.deleteItem=function(e){var t=new Parse.Query(c);t.get(e,{success:function(e){e.destroy({success:function(e){n.pop("success","Registro eliminado correctamente")},error:function(e,t){n.pop("error","Ocurrió un error al eliminar el registro")}})},error:function(e,t){n.pop("error","Ocurrió un error al obtener el registro")}})},e.getData=function(){l.start(),e.rowCollection=[];var t=new Parse.Query(c);t.greaterThanOrEqualTo("travelDate",e.dates.fromDate),t.lessThanOrEqualTo("travelDate",e.dates.toDate),t.find({success:function(t){for(var r=0;r<t.length;r++)e.rowCollection.push({id:t[r].id,destination:t[r].attributes.destination,driver:t[r].attributes.driver,client:t[r].attributes.client,invoiceId:t[r].attributes.invoiceId,truckId:t[r].attributes.truckId,status:t[r].attributes.status,total:t[r].attributes.total,comment:t[r].attributes.comment,travelDate:t[r].attributes.travelDate});l.complete(),n.pop("success","La busqueda por defecto es de un año hacia atras desde la fecha actual, puedes cambiar el rango de fecha para personalizar tu búsqueda","6DYcJpwPbm"==i.currentUser.id?"Te amo dundita <3":"")},error:function(e){l.complete(),n.pop("error","Ocurrio un error al obtener los viajes")}})},e.getData(),e.changeStatus=function(t){e.saveVisible=!0,e.collectionToSave.push(t)},e.add=function(){l.start();var t=new c;t.save({destination:e.travel.destination,driver:e.travel.driver,client:e.travel.client,invoiceId:e.travel.invoiceId,truckId:e.travel.truckId,status:"true"==e.travel.status?!0:!1,total:e.travel.total,comment:e.travel.comment,travelDate:e.travel.travelDate},{success:function(t){n.pop("success","Viaje Guardado"),l.complete(),e.travel.id=t.id,e.rowCollection.push(e.travel)},error:function(e,t){n.pop("error","Error al guardar"),l.complete()}})},e.closeDialog=function(){a.hide()},e.statuses=[],e.statuses.push({id:!1,name:"Pendiente"}),e.statuses.push({id:!0,name:"Pagado"}),e.places=[],e.places.push({id:1,name:"La Ceiba"}),e.places.push({id:2,name:"Tegucigalpa"}),e.places.push({id:3,name:"Santa Rosa de Copan"}),e.places.push({id:4,name:"Comayagua"}),e.places.push({id:4,name:"Yoro"}),e.places.push({id:4,name:"Morazan"}),e.map={center:{latitude:45,longitude:-73},zoom:8},e.logOut=function(){r.logOut().then(function(){t.go("login")},function(e){u("Ocurrio un error al cerrar sesión")})},e.displayedCollection=[].concat(e.rowCollection);var u;e.showDialog=function(t){var r=angular.element(document.body);u=a.alert({parent:r,targetEvent:t,template:'<md-dialog style="width:60%" aria-label="Nuevo Viaje" ng-cloak><form><md-toolbar><div class="md-toolbar-tools"><h2>Nuevo Viaje</h2><span flex></span><md-button class="md-icon-button" ng-click="ctrl.closeDialog()"><md-icon md-svg-src="images/close_svg.svg" aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="md-dialog-content"><div class="form-content"><div class="form-group"><md-datepicker ng-model="ctrl.travel.travelDate" md-placeholder="Fecha"></md-datepicker></div><div class="form-group"> <md-input-container class="md-block" flex-gt-sm><label>Lugar de destino</label><input ng-model="ctrl.travel.destination"></md-input-container></div><div class="form-group"><md-input-container class="md-block" flex-gt-sm> <label>Cliente</label><input ng-model="ctrl.travel.client"></md-input-container></div><div class="form-group"><md-input-container class="md-block" flex-gt-sm><label>Nombre del conductor</label><input ng-model="ctrl.travel.driver"></md-input-container></div><div class="form-group"><md-input-container class="md-block" flex-gt-sm><label>Placa del camion</label><input ng-model="ctrl.travel.truckId"> </md-input-container></div><div class="form-group"><md-input-container class="md-block" flex-gt-sm><label>No. Documento</label><input ng-model="ctrl.travel.invoiceId"></md-input-container></div><div class="form-group"><md-input-container class="md-block" flex-gt-sm><label>Total</label><input type="number" ng-model="ctrl.travel.total"></md-input-container></div><div class="form-group"><md-input-container class="md-block" flex-gt-sm> <label>Comentario</label><input ng-model="ctrl.travel.comment"></md-input-container></div><div class="form-group"><md-input-container class="md-block" flex-gt-sm> <label>Estado</label><md-select ng-model="ctrl.travel.status"><md-option ng-repeat="item in ctrl.statuses" value="{{item.id}}">{{item.name}}</md-option></md-select></md-input-container></div></div></div></md-dialog-content><md-dialog-actions layout="row"><md-button ng-click="ctrl.closeDialog()">Cancelar</md-button><md-button ng-click="ctrl.add()" style="margin-right:20px;">Guardar</md-button></md-dialog-actions></form></md-dialog>',locals:{statuses:e.statuses,travel:e.travel,add:e.add,closeDialog:e.closeDialog},bindToController:!0,controllerAs:"ctrl"}),a.show(u)["finally"](function(){u=void 0})}}]),app.factory("ParseService",["$q","$rootScope","$state","cfpLoadingBar","toaster",function(e,t,r,a,o){var n="qJxcfIMqIKTfFayzvuKz2B6MgHbK78BANYgxRgT6",l="eRQoTWrvqNXhmUbYrtvW5v27c8dKenmXti5pq1du";return{signUp:function(e){var r=new Parse.User;return r.set("email",e.email),r.set("username",e.user),r.set("password",e.pass),r.signUp(null,{success:function(e){t.currentUser=e,t.$apply()},error:function(e,t){alert("Unable to sign up:  "+t.code+" "+t.message)}})},logIn:function(e){return a.start(),Parse.User.logIn(e.userName,e.pass,{success:function(a){t.currentUser=a,t.$apply(),r.go("dashboard"),o.pop("success","Bienvenido!",e.userName+"!")},error:function(e,t){alert("Error: "+t.message+" ("+t.code+")")}})},logOut:function(){var r=e.defer();return Parse.User.logOut(),t.currentUser=null,r.resolve(),r.promise},init:function(){return console.log("iniciado"),Parse.initialize(n,l),t.currentUser=Parse.User.current()}}}]);